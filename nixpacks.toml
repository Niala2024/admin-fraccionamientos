# nixpacks.toml - VERSIÓN DE EMERGENCIA ESTABLE

providers = ["python", "node"]

[phases.setup]
nixPkgs = ["python3", "nodejs", "npm", "cairo", "pango", "gdk-pixbuf", "libffi", "gcc"]

[phases.build]
# FASE 1: Solo compilar archivos. 
# ¡IMPORTANTE! NO poner 'migrate' aquí o Railway fallará.
cmds = [
    "cd frontend && npm install && npm run build",
    "pip install -r requirements.txt",
    "python manage.py collectstatic --noinput"
]

[start]
# FASE 2: Arrancar y conectar BD.
# Aquí sí hay internet, por eso ponemos el migrate aquí.
cmd = "python manage.py migrate && python manage.py createsuperuser --noinput || echo 'Listo' && gunicorn core.wsgi:application --bind 0.0.0.0:$PORT"